{% extends "base.html" %}
{% block content %}
<h1 class="mb-4">Pridėti naują korepetitorių</h1>

<form method="POST">
<div class="row">
    <div class="col-md-4 mb-3">
        <label class="form-label">Vardas</label>
        <input type="text" class="form-control" name="first_name" required>
    </div>
    <div class="col-md-4 mb-3">
        <label class="form-label">Antras vardas (nebūtinas)</label>
        <input type="text" class="form-control" name="second_name">
    </div>
    <div class="col-md-4 mb-3">
        <label class="form-label">Pavardė</label>
        <input type="text" class="form-control" name="last_name" required>
    </div>
</div>

<div class="row">
    <div class="col-md-4 mb-3">
        <label class="form-label">Gimimo data</label>
        <input type="date" class="form-control" name="date_of_birth" required>
    </div>
    <div class="col-md-4 mb-3">
        <label class="form-label">El. paštas</label>
        <input type="email" class="form-control" name="email" required>
    </div>
    <div class="col-md-4 mb-3">
        <label class="form-label">Slaptažodis</label>
        <input type="password" class="form-control" name="password" required>
    </div>
</div>

<div class="row">
    <div class="col-md-6 mb-3">
        <label class="form-label">Telefonas (nebūtinas)</label>
        <input type="text" class="form-control" name="phone_number">
    </div>
    <div class="col-md-6 mb-3 position-relative">
        <label class="form-label">Dalykai</label>
        <input type="text" class="form-control" id="subjectsInput" name="subjects_display" readonly placeholder="Pasirinkite dalykus">

        <!-- Iššokantis meniu su dalykais -->
        <div id="subjectsMenu" class="border rounded bg-white shadow p-2 position-absolute w-100" style="display:none; z-index:1000; max-height:300px; overflow-y:auto;">
            {% for subject in ["Matematika","Fizika","Chemija","Biologija","Lietuvių kalba","Anglų kalba","Istorija","Geografija","Informatika"] %}
            <div class="subject-item mb-1">
                <input type="checkbox" value="{{ subject }}" name="subjects"> {{ subject }}
                <select class="form-select form-select-sm d-inline-block w-auto ms-2" name="max_class_{{ subject }}" disabled>
                    {% for i in range(1,13) %}
                    <option value="{{ i }}">{{ i }} kl.</option>
                    {% endfor %}
                </select>
            </div>
            {% endfor %}
        </div>
    </div>
</div>

<button type="submit" class="btn btn-primary">Pridėti</button>
<a href="{{ url_for('tutors') }}" class="btn btn-secondary">Atgal</a>
</form>

<script>
    const input = document.getElementById('subjectsInput');
    const menu = document.getElementById('subjectsMenu');
    const checkboxes = menu.querySelectorAll('input[type=checkbox]');

    // Rodyti / slėpti meniu
    input.addEventListener('click', (e) => {
        e.stopPropagation();
        menu.style.display = menu.style.display === 'none' ? 'block' : 'none';
    });

    // Kai pažymimas dalykas – įjungiam klasės pasirinkimą
    checkboxes.forEach(cb => {
        cb.addEventListener('change', () => {
            const select = cb.parentElement.querySelector('select');
            select.disabled = !cb.checked;

            const selected = Array.from(checkboxes)
                .filter(c => c.checked)
                .map(c => c.value)
                .join(', ');
            input.value = selected;
        });
    });

    // Paspaudus už laukelio ribų – paslėpti meniu
    document.addEventListener('click', (e) => {
        if (!menu.contains(e.target) && e.target !== input) {
            menu.style.display = 'none';
        }
    });
</script>
{% endblock %}
